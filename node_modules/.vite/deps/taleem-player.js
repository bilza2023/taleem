import "./chunk-SSYGV25P.js";

// node_modules/taleem-player/dist/taleem-player.esm.js
var TitleSlide = {
  type: "titleSlide",
  fromJSON(raw) {
    var _a, _b;
    const title = (_b = (_a = raw.data) == null ? void 0 : _a.find((d) => d.name === "title")) == null ? void 0 : _b.content;
    if (!title) {
      throw new Error("titleSlide: requires title");
    }
    return Object.freeze({
      type: "titleSlide",
      render() {
        return `
          <section class="slide titleSlide">
            <h1>${title}</h1>
          </section>
        `;
      }
    });
  }
};
var TitleAndSubtitleSlide = {
  type: "titleAndSubtitle",
  fromJSON(raw) {
    var _a, _b, _c, _d;
    const title = (_b = (_a = raw.data) == null ? void 0 : _a.find((d) => d.name === "title")) == null ? void 0 : _b.content;
    const subtitle = (_d = (_c = raw.data) == null ? void 0 : _c.find((d) => d.name === "subtitle")) == null ? void 0 : _d.content;
    if (!title || !subtitle) {
      throw new Error("titleAndSubtitle: requires title and subtitle");
    }
    return Object.freeze({
      type: "titleAndSubtitle",
      render() {
        return `
          <section class="slide titleAndSubtitle">
            <h1>${title}</h1>
            <h2>${subtitle}</h2>
          </section>
        `;
      }
    });
  }
};
var TitleAndParaSlide = {
  type: "titleAndPara",
  fromJSON(raw) {
    var _a, _b, _c, _d;
    const title = (_b = (_a = raw.data) == null ? void 0 : _a.find((d) => d.name === "title")) == null ? void 0 : _b.content;
    const para = (_d = (_c = raw.data) == null ? void 0 : _c.find((d) => d.name === "para")) == null ? void 0 : _d.content;
    if (!title || !para) {
      throw new Error("titleAndPara: requires title and para");
    }
    return Object.freeze({
      type: "titleAndPara",
      render() {
        return `
          <section class="slide titleAndPara">
            <h1>${title}</h1>
            <p>${para}</p>
          </section>
        `;
      }
    });
  }
};
var BulletListSlide = {
  type: "bulletList",
  fromJSON(raw) {
    var _a;
    const bullets = (_a = raw.data) == null ? void 0 : _a.filter((d) => d.name === "bullet").map((d) => d.content);
    if (!bullets || bullets.length === 0) {
      throw new Error("bulletList: requires at least one bullet");
    }
    return Object.freeze({
      type: "bulletList",
      bullets,
      render({ visibleCount = bullets.length, activeIndex = null } = {}) {
        return `
          <section class="slide bulletList">
            <ul>
              ${bullets.map((text, i) => {
          if (i >= visibleCount)
            return "";
          const cls = i === activeIndex ? "is-active" : activeIndex !== null && i < activeIndex ? "is-dim" : "";
          return `<li class="${cls}">${text}</li>`;
        }).join("")}
            </ul>
          </section>
        `;
      }
    });
  }
};
var TwoColumnTextSlide = {
  type: "twoColumnText",
  fromJSON(raw) {
    var _a, _b;
    const left = (_a = raw.data) == null ? void 0 : _a.filter((d) => d.name === "left").map((d) => d.content);
    const right = (_b = raw.data) == null ? void 0 : _b.filter((d) => d.name === "right").map((d) => d.content);
    if (!(left == null ? void 0 : left.length) || !(right == null ? void 0 : right.length)) {
      throw new Error("twoColumnText: requires left and right");
    }
    return Object.freeze({
      type: "twoColumnText",
      render() {
        return `
          <section class="slide twoColumnText">
            <div class="col left">
              ${left.map((v) => `<div>${v}</div>`).join("")}
            </div>
            <div class="col right">
              ${right.map((v) => `<div>${v}</div>`).join("")}
            </div>
          </section>
        `;
      }
    });
  }
};
var ImageSlide = {
  type: "imageSlide",
  fromJSON(raw) {
    var _a, _b;
    const src = (_b = (_a = raw.data) == null ? void 0 : _a.find((d) => d.name === "image")) == null ? void 0 : _b.content;
    if (!src)
      throw new Error("imageSlide: image required");
    return Object.freeze({
      type: "imageSlide",
      src,
      render() {
        return `
          <section class="slide imageSlide">
            <img src="${src}" alt="" />
          </section>
        `;
      }
    });
  }
};
var FillImageSlide = {
  type: "fillImage",
  fromJSON(raw) {
    var _a, _b;
    const image = (_b = (_a = raw.data) == null ? void 0 : _a.find((d) => d.name === "image")) == null ? void 0 : _b.content;
    if (!image) {
      throw new Error("fillImage: image required");
    }
    return Object.freeze({
      type: "fillImage",
      image,
      render() {
        return `
          <section class="slide fillImage">
            <img src="${image}" alt="" />
          </section>
        `;
      }
    });
  }
};
var ImageWithTitleSlide = {
  type: "imageWithTitle",
  fromJSON(raw) {
    var _a, _b, _c, _d;
    const src = (_b = (_a = raw.data) == null ? void 0 : _a.find((d) => d.name === "image")) == null ? void 0 : _b.content;
    const title = (_d = (_c = raw.data) == null ? void 0 : _c.find((d) => d.name === "title")) == null ? void 0 : _d.content;
    if (!src || !title) {
      throw new Error("imageWithTitle: image and title required");
    }
    return Object.freeze({
      type: "imageWithTitle",
      src,
      title,
      render() {
        return `
          <section class="slide imageWithTitle">
            <img src="${src}" alt="" />
            <h1>${title}</h1>
          </section>
        `;
      }
    });
  }
};
var ImageWithCaptionSlide = {
  type: "imageWithCaption",
  fromJSON(raw) {
    var _a, _b, _c, _d;
    const src = (_b = (_a = raw.data) == null ? void 0 : _a.find((d) => d.name === "image")) == null ? void 0 : _b.content;
    const caption = (_d = (_c = raw.data) == null ? void 0 : _c.find((d) => d.name === "caption")) == null ? void 0 : _d.content;
    if (!src || !caption) {
      throw new Error("imageWithCaption: image and caption required");
    }
    return Object.freeze({
      type: "imageWithCaption",
      src,
      caption,
      render() {
        return `
          <figure class="slide imageWithCaption">
            <img src="${src}" alt="" />
            <figcaption>${caption}</figcaption>
          </figure>
        `;
      }
    });
  }
};
var ImageLeftBulletsRightSlide = {
  type: "imageLeftBulletsRight",
  fromJSON(raw) {
    var _a, _b, _c;
    const image = (_b = (_a = raw.data) == null ? void 0 : _a.find((d) => d.name === "image")) == null ? void 0 : _b.content;
    const bullets = (_c = raw.data) == null ? void 0 : _c.filter((d) => d.name === "bullet").map((d) => d.content);
    if (!image || !bullets || bullets.length === 0) {
      throw new Error("imageLeftBulletsRight: image and bullets required");
    }
    return Object.freeze({
      type: "imageLeftBulletsRight",
      image,
      bullets,
      render({ visibleCount = bullets.length } = {}) {
        return `
          <section class="slide imageLeftBulletsRight">
            <img src="${image}" alt="" />
            <ul>
              ${bullets.map(
          (text, i) => i < visibleCount ? `<li>${text}</li>` : ""
        ).join("")}
            </ul>
          </section>
        `;
      }
    });
  }
};
var ImageRightBulletsLeftSlide = {
  type: "imageRightBulletsLeft",
  fromJSON(raw) {
    var _a, _b, _c;
    const image = (_b = (_a = raw.data) == null ? void 0 : _a.find((d) => d.name === "image")) == null ? void 0 : _b.content;
    const bullets = (_c = raw.data) == null ? void 0 : _c.filter((d) => d.name === "bullet").map((d) => d.content);
    if (!image || !bullets || bullets.length === 0) {
      throw new Error("imageRightBulletsLeft: image and bullets required");
    }
    return Object.freeze({
      type: "imageRightBulletsLeft",
      image,
      bullets,
      render({ visibleCount = bullets.length } = {}) {
        return `
          <section class="slide imageRightBulletsLeft">
            <ul>
              ${bullets.map(
          (text, i) => i < visibleCount ? `<li>${text}</li>` : ""
        ).join("")}
            </ul>
            <img src="${image}" alt="" />
          </section>
        `;
      }
    });
  }
};
var TableSlide = {
  type: "table",
  fromJSON(raw) {
    const rows = raw.data;
    if (!Array.isArray(rows) || rows.length === 0) {
      console.warn("Empty table skipped", raw);
      return null;
    }
    return Object.freeze({
      type: "table",
      render() {
        return `
          <table class="slide table">
            <tbody>
              ${rows.map(
          (row) => `<tr>${row.map((cell) => `<td>${cell}</td>`).join("")}</tr>`
        ).join("")}
            </tbody>
          </table>
        `;
      }
    });
  }
};
var StatisticSlide = {
  type: "statistic",
  fromJSON(raw) {
    var _a, _b, _c, _d;
    const label = (_b = (_a = raw.data) == null ? void 0 : _a.find((d) => d.name === "label")) == null ? void 0 : _b.content;
    const number = (_d = (_c = raw.data) == null ? void 0 : _c.find((d) => d.name === "number")) == null ? void 0 : _d.content;
    if (!label || number === void 0) {
      throw new Error("statistic: requires number and label");
    }
    return Object.freeze({
      type: "statistic",
      label,
      number,
      render() {
        return `
          <section class="slide statistic">
            <div class="stat-value">${number}</div>
            <div class="stat-label">${label}</div>
          </section>
        `;
      }
    });
  }
};
var BigNumberSlide = {
  type: "bigNumber",
  fromJSON(raw) {
    var _a, _b, _c, _d;
    const number = (_b = (_a = raw.data) == null ? void 0 : _a.find((d) => d.name === "number")) == null ? void 0 : _b.content;
    const label = (_d = (_c = raw.data) == null ? void 0 : _c.find((d) => d.name === "label")) == null ? void 0 : _d.content;
    if (!number) {
      throw new Error("bigNumber: number required");
    }
    return Object.freeze({
      type: "bigNumber",
      number,
      label,
      render() {
        return `
          <section class="slide bigNumber">
            <div class="number">${number}</div>
            ${label ? `<div class="label">${label}</div>` : ""}
          </section>
        `;
      }
    });
  }
};
var BarChartSlide = {
  type: "barChart",
  fromJSON(raw) {
    var _a;
    const bars = (_a = raw.data) == null ? void 0 : _a.filter((d) => d.name === "bar").map((d) => ({
      label: d.label,
      value: d.value
    }));
    if (!bars || bars.length === 0) {
      throw new Error("barChart: requires at least one bar");
    }
    return Object.freeze({
      type: "barChart",
      bars,
      render({ visibleCount = bars.length, activeIndex = null } = {}) {
        return `
          <section class="slide barChart">
            <ul class="bars">
              ${bars.map((b, i) => {
          if (i >= visibleCount)
            return "";
          const cls = i === activeIndex ? "is-active" : activeIndex !== null && i < activeIndex ? "is-dim" : "";
          return `
                  <li class="bar ${cls}">
                    <span class="bar-label">${b.label}</span>
                    <span class="bar-value">${b.value}</span>
                  </li>
                `;
        }).join("")}
            </ul>
          </section>
        `;
      }
    });
  }
};
var DonutChartSlide = {
  type: "donutChart",
  fromJSON(raw) {
    const segments = [];
    let current = null;
    for (const d of raw.data || []) {
      if (d.name === "percent") {
        current = { percent: d.content };
        segments.push(current);
      } else if (current && d.name === "label") {
        current.label = d.content;
      } else if (current && d.name === "color") {
        current.color = d.content;
      }
    }
    if (!segments.length) {
      throw new Error("donutChart: requires at least one segment");
    }
    return Object.freeze({
      type: "donutChart",
      segments,
      render({ visibleCount = segments.length } = {}) {
        return `
          <section class="slide donutChart">
            <ul>
              ${segments.map((s, i) => {
          if (i >= visibleCount)
            return "";
          return `<li>${s.label}: ${s.percent}%</li>`;
        }).join("")}
            </ul>
          </section>
        `;
      }
    });
  }
};
var QuoteSlide = {
  type: "quoteSlide",
  fromJSON(raw) {
    var _a, _b, _c, _d;
    const quote = (_b = (_a = raw.data) == null ? void 0 : _a.find((d) => d.name === "quote")) == null ? void 0 : _b.content;
    const author = (_d = (_c = raw.data) == null ? void 0 : _c.find((d) => d.name === "author")) == null ? void 0 : _d.content;
    if (!quote) {
      throw new Error("quoteSlide: quote required");
    }
    return Object.freeze({
      type: "quoteSlide",
      quote,
      author,
      render() {
        return `
          <blockquote class="slide quoteSlide">
            <p>${quote}</p>
            ${author ? `<footer>${author}</footer>` : ""}
          </blockquote>
        `;
      }
    });
  }
};
var QuoteWithImageSlide = {
  type: "quoteWithImage",
  fromJSON(raw) {
    var _a, _b, _c, _d, _e, _f;
    const quote = (_b = (_a = raw.data) == null ? void 0 : _a.find((d) => d.name === "quote")) == null ? void 0 : _b.content;
    const image = (_d = (_c = raw.data) == null ? void 0 : _c.find((d) => d.name === "image")) == null ? void 0 : _d.content;
    const author = (_f = (_e = raw.data) == null ? void 0 : _e.find((d) => d.name === "author")) == null ? void 0 : _f.content;
    if (!quote || !image) {
      throw new Error("quoteWithImage: quote and image required");
    }
    return Object.freeze({
      type: "quoteWithImage",
      quote,
      image,
      author,
      render() {
        return `
          <section class="slide quoteWithImage">
            <img src="${image}" alt="" />
            <blockquote>
              <p>${quote}</p>
              ${author ? `<footer>${author}</footer>` : ""}
            </blockquote>
          </section>
        `;
      }
    });
  }
};
var CornerWordsSlide = {
  type: "cornerWordsSlide",
  fromJSON(raw) {
    var _a;
    const cards = (_a = raw.data) == null ? void 0 : _a.filter((d) => d.name === "card").map((d) => ({ icon: d.icon, label: d.label }));
    if (!cards || cards.length === 0) {
      throw new Error("cornerWordsSlide: requires at least one card");
    }
    return Object.freeze({
      type: "cornerWordsSlide",
      cards,
      render({ visibleCount = cards.length } = {}) {
        return `
          <section class="slide cornerWordsSlide">
            ${cards.map((c, i) => {
          if (i >= visibleCount)
            return "";
          return `
                <span class="corner-card corner-${i + 1}">
                  <span class="icon">${c.icon}</span>
                  <span class="label">${c.label}</span>
                </span>
              `;
        }).join("")}
          </section>
        `;
      }
    });
  }
};
var ContactSlide = {
  type: "contactSlide",
  fromJSON(raw) {
    var _a;
    const items = (_a = raw.data) == null ? void 0 : _a.map((d) => d.content);
    if (!items || items.length === 0) {
      throw new Error("contactSlide: content required");
    }
    return Object.freeze({
      type: "contactSlide",
      items,
      render() {
        return `
          <section class="slide contactSlide">
            ${items.map((text) => `<div>${text}</div>`).join("")}
          </section>
        `;
      }
    });
  }
};
var EqSlide = {
  type: "eq",
  fromJSON(raw) {
    var _a;
    const lines = (_a = raw.data) == null ? void 0 : _a.filter((d) => d.name === "line").map((d) => ({
      type: d.type,
      content: d.content
    }));
    if (!lines || lines.length === 0) {
      throw new Error("eq: requires at least one line");
    }
    return Object.freeze({
      type: "eq",
      lines,
      render({ visibleCount = lines.length, activeIndex = null } = {}) {
        return `
          <section class="slide eq">
            ${lines.map((l, i) => {
          if (i >= visibleCount)
            return "";
          const cls = i === activeIndex ? "is-active" : activeIndex !== null && i < activeIndex ? "is-dim" : "";
          return `<div class="eq-line ${cls}">${l.content}</div>`;
        }).join("")}
          </section>
        `;
      }
    });
  }
};
var SlideTemplates = {
  titleSlide: TitleSlide,
  titleAndSubtitle: TitleAndSubtitleSlide,
  titleAndPara: TitleAndParaSlide,
  bulletList: BulletListSlide,
  twoColumnText: TwoColumnTextSlide,
  imageSlide: ImageSlide,
  fillImage: FillImageSlide,
  imageWithTitle: ImageWithTitleSlide,
  imageWithCaption: ImageWithCaptionSlide,
  imageLeftBulletsRight: ImageLeftBulletsRightSlide,
  imageRightBulletsLeft: ImageRightBulletsLeftSlide,
  table: TableSlide,
  statistic: StatisticSlide,
  bigNumber: BigNumberSlide,
  barChart: BarChartSlide,
  donutChart: DonutChartSlide,
  quoteSlide: QuoteSlide,
  quoteWithImage: QuoteWithImageSlide,
  cornerWordsSlide: CornerWordsSlide,
  contactSlide: ContactSlide,
  eq: EqSlide
};
function getSlideTemplate(type) {
  const template = SlideTemplates[type];
  if (!template) {
    throw new Error(`Unknown slide template type "${type}"`);
  }
  return template;
}
function createStage(mount) {
  if (!mount)
    throw new Error("taleem-player: mount is required");
  const root = typeof mount === "string" ? document.querySelector(mount) : mount;
  if (!root)
    throw new Error("taleem-player: mount element not found");
  root.innerHTML = "";
  const stage = document.createElement("div");
  stage.className = "taleem-player-stage";
  stage.style.position = "relative";
  stage.style.width = "100%";
  stage.style.height = "100%";
  root.appendChild(stage);
  function clear() {
    stage.innerHTML = "";
  }
  function destroy() {
    root.innerHTML = "";
  }
  return {
    el: stage,
    clear,
    destroy
  };
}
function createTaleemPlayer({ mount, deck }) {
  const stage = createStage(mount);
  let lastSlide = null;
  let lastRenderedKey = null;
  function getSlideAtTime(deck2, time) {
    const slides = deck2.deck;
    for (let i = slides.length - 1; i >= 0; i--) {
      const s = slides[i];
      if (time >= s.start && time < s.end)
        return s;
    }
    return null;
  }
  function computeRenderState(slide, time) {
    if (!Array.isArray(slide.data)) {
      return {};
    }
    let visibleCount = 0;
    let activeIndex = -1;
    slide.data.forEach((item, index) => {
      if (typeof item.showAt === "number" && time >= item.showAt) {
        visibleCount++;
        activeIndex = index;
      }
    });
    return {
      visibleCount,
      activeIndex
    };
  }
  function renderAt(time) {
    const slide = getSlideAtTime(deck, time);
    if (!slide) {
      stage.clear();
      lastSlide = null;
      lastRenderedKey = null;
      return;
    }
    const renderState = computeRenderState(slide, time);
    const renderKey = `${slide.start}-${renderState.visibleCount}-${renderState.activeIndex}`;
    if (slide !== lastSlide) {
      stage.clear();
      lastSlide = slide;
      lastRenderedKey = null;
    }
    if (renderKey === lastRenderedKey) {
      return;
    }
    const Template = getSlideTemplate(slide.type);
    const slideInstance = Template.fromJSON(slide);
    const html = slideInstance.render(renderState);
    stage.el.innerHTML = html;
    lastRenderedKey = renderKey;
  }
  function destroy() {
    stage.destroy();
  }
  return {
    renderAt,
    destroy
  };
}
function createTaleemBrowser({ mount, deck }) {
  if (!mount) {
    throw new Error("taleem-browser: mount is required");
  }
  if (!deck || !Array.isArray(deck.deck)) {
    throw new Error("taleem-browser: valid deck-v1 required");
  }
  const root = typeof mount === "string" ? document.querySelector(mount) : mount;
  if (!root) {
    throw new Error("taleem-browser: mount not found");
  }
  root.innerHTML = `
    <div class="taleem-browser-bg"></div>
    <div class="taleem-browser-slide"></div>
  `;
  const bgEl = root.querySelector(".taleem-browser-bg");
  const slideEl = root.querySelector(".taleem-browser-slide");
  applyBackground(bgEl, deck.background);
  const slides = deck.deck.map((slideJSON, i) => {
    if (!slideJSON.type) {
      throw new Error(`taleem-browser: slide ${i} missing type`);
    }
    const Template = getSlideTemplate(slideJSON.type);
    if (!Template) {
      throw new Error(`taleem-browser: unknown slide type "${slideJSON.type}"`);
    }
    return Template.fromJSON(slideJSON);
  });
  const total = slides.length;
  function render(index, renderState = {}) {
    if (index < 0 || index >= total)
      return;
    const slide = slides[index];
    slideEl.innerHTML = slide.render(renderState);
  }
  return {
    render,
    getTotal() {
      return total;
    }
  };
}
function applyBackground(el, bg = {}) {
  el.style.position = "absolute";
  el.style.inset = "0";
  el.style.zIndex = "0";
  el.style.backgroundColor = bg.backgroundColor || "#000";
  el.style.backgroundImage = bg.backgroundImage ? `url(${bg.backgroundImage})` : "none";
  el.style.backgroundSize = "cover";
  el.style.backgroundPosition = "center";
  el.style.opacity = bg.backgroundImageOpacity !== void 0 ? bg.backgroundImageOpacity : 1;
}
function assignMockTimings(goldenDeck, slideDuration = 5) {
  if (!goldenDeck || !Array.isArray(goldenDeck.deck) || typeof slideDuration !== "number") {
    throw new Error("assignMockTimings: invalid deck or slideDuration");
  }
  let currentTime = 0;
  const deckWithTimings = {
    ...goldenDeck,
    deck: goldenDeck.deck.map((slide) => {
      const start = currentTime;
      const end = start + slideDuration;
      currentTime = end;
      const data = Array.isArray(slide.data) ? slide.data.map((item) => ({
        ...item,
        showAt: start + (typeof item.showAt === "number" ? item.showAt : 0)
      })) : slide.data;
      return {
        ...slide,
        start,
        end,
        data
      };
    })
  };
  return deckWithTimings;
}
function resolveAssetPaths(deck, IMG_BASE) {
  var _a;
  if (((_a = deck.background) == null ? void 0 : _a.backgroundImage) && typeof deck.background.backgroundImage === "string") {
    deck.background.backgroundImage = IMG_BASE + deck.background.backgroundImage.split("/").pop();
  }
  deck.deck.forEach((slide) => {
    var _a2;
    (_a2 = slide.data) == null ? void 0 : _a2.forEach((item) => {
      if (item.name === "image" && typeof item.content === "string") {
        item.content = IMG_BASE + item.content.split("/").pop();
      }
    });
  });
  return deck;
}
function resolveBackground2(deck, ASSET_BASE) {
  if (!deck || !deck.background)
    return deck;
  const bg = deck.background;
  if (typeof bg.backgroundImage === "string" && bg.backgroundImage.length > 0) {
    bg.backgroundImage = ASSET_BASE + bg.backgroundImage.split("/").pop();
  }
  if (bg.backgroundImageOpacity === void 0) {
    bg.backgroundImageOpacity = 1;
  }
  return deck;
}
export {
  assignMockTimings,
  createTaleemBrowser,
  createTaleemPlayer,
  resolveAssetPaths,
  resolveBackground2 as resolveBackground
};
//# sourceMappingURL=taleem-player.js.map
