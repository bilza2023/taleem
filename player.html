<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Taleem Player â€“ Demo</title>

  <!-- Local authoritative Taleem CSS -->
  <link rel="stylesheet" href="./taleem.css" />

  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #111;
      color: #fff;
    }

    #app {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }

    #timebar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 32px;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(6px);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      z-index: 10;
    }
  </style>
</head>
<body>

  <div id="app"></div>
  <div id="timebar">t = 0s</div>

  <script type="module">
    import { createTaleemPlayer } from "taleem-player";
    import { goldenDeckV1 } from "taleem-core";

    // ----------------------------------
    // clone canonical golden deck
    // ----------------------------------
    const deck = structuredClone(goldenDeckV1);

    // ----------------------------------
    // base path (same as browser demos)
    // ----------------------------------
    const BASE = location.pathname.replace(/\/[^/]*$/, "");
    const IMG_BASE = `${BASE}/public/media/images/`;

    // ----------------------------------
    // FIX IMAGE PATHS (canonical rule)
    // ----------------------------------
    function fixImagePaths(deck) {
      deck.deck.forEach(slide => {
        slide.data?.forEach(item => {
          if (item.name === "image" && typeof item.content === "string") {
            item.content = IMG_BASE + item.content.split("/").pop();
          }
        });
      });

      if (deck.background?.backgroundImage) {
        deck.background.backgroundImage =
          IMG_BASE + deck.background.backgroundImage.split("/").pop();
      }
    }

    fixImagePaths(deck);

    // ----------------------------------
    // create player
    // ----------------------------------
    const player = createTaleemPlayer({
      mount: "#app",
      deck
    });

    // ----------------------------------
    // app-owned time (SECONDS)
    // ----------------------------------
    let t = 0;
    const STEP = 1;
    const timebar = document.getElementById("timebar");

    function tick() {
      player.renderAt(t);
      timebar.textContent = `t = ${t}s`;
      t += STEP;
    }

    // initial render
    tick();

    // external clock
    setInterval(tick, STEP * 1000);

    // debug
    window.player = player;
  </script>

</body>
</html>
