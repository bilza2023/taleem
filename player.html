<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Taleem Player â€“ Demo</title>
  
  <link
  rel="stylesheet"
  href="https://unpkg.com/taleem-browser@0.2.0/dist/taleem.css"
/>

  <!-- Taleem Slides CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/taleem-slides@0.5.0/dist/taleem.css"
  />

  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #111;
      color: #fff;
    }

    #app {
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }

    /* --- time display --- */
    #timebar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 32px;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(6px);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      letter-spacing: 0.5px;
      z-index: 1000;
    }
  </style>
</head>
<body>

  <div id="app"></div>
  <div id="timebar">t = 0s</div>

  <script type="module">
    import { createTaleemPlayer } from
      "https://unpkg.com/taleem-player@0.5.0/dist/taleem-player.esm.js";

    // base path (vite + local safe)
    const BASE = location.pathname.replace(/\/[^/]*$/, "");

    // load deck
    const deck = await fetch(`${BASE}/decks/demo-gold-timings.json`)
      .then(r => r.json());

    // fix image paths
    function fixImagePaths(deck) {
      deck.deck.forEach(slide => {
        slide.data?.forEach(item => {
          if (
            typeof item.content === "string" &&
            item.content.endsWith(".webp")
          ) {
            item.content =
              `${BASE}/public/media/images/${item.content.split("/").pop()}`;
          }
        });
      });

      if (deck.background?.backgroundImage) {
        deck.background.backgroundImage =
          `${BASE}/public/media/images/${deck.background.backgroundImage.split("/").pop()}`;
      }
    }

    fixImagePaths(deck);

    // create player
    const player = createTaleemPlayer({
      mount: "#app",
      deck
    });

    // -----------------------------
    // app-owned ticker
    // -----------------------------
    let t = 0;
    const STEP = 1;
    const timebar = document.getElementById("timebar");

    function tick() {
      player.renderAt(t);
      timebar.textContent = `t = ${t}s`;
      t += STEP;
    }

    // initial render
    tick();

    setInterval(tick, STEP * 1000);

    // expose for manual testing
    window.player = player;
  </script>

</body>
</html>
